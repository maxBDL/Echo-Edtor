(function(g,c){typeof exports=="object"&&typeof module<"u"?c(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],c):(g=typeof globalThis<"u"?globalThis:g||self,c(g["vue-audio-visual"]={},g.Vue))})(this,function(g,c){"use strict";var Ut=Object.defineProperty;var xt=(g,c,E)=>c in g?Ut(g,c,{enumerable:!0,configurable:!0,writable:!0,value:E}):g[c]=E;var l=(g,c,E)=>(xt(g,typeof c!="symbol"?c+"":c,E),E);var E;const ie=typeof window<"u",Ze=n=>typeof n=="string",et=()=>{};ie&&((E=window==null?void 0:window.navigator)==null?void 0:E.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function p(n){return typeof n=="function"?n():c.unref(n)}function Ce(n,e=!1,t="Timeout"){return new Promise((r,i)=>{setTimeout(e?()=>i(t):r,n)})}function tt(n){return n}function nt(n,...e){return e.some(t=>t in n)}function ae(){const n=[],e=i=>{const a=n.indexOf(i);a!==-1&&n.splice(a,1)};return{on:i=>(n.push(i),{off:()=>e(i)}),off:e,trigger:i=>{n.forEach(a=>a(i))}}}function oe(n){return c.getCurrentScope()?(c.onScopeDispose(n),!0):!1}function le(n){return typeof n=="function"?c.computed(n):c.ref(n)}function ce(n,e=!1){function t(u,{flush:y="sync",deep:C=!1,timeout:b,throwOnTimeout:z}={}){let T=null;const I=[new Promise(D=>{T=c.watch(n,q=>{u(q)!==e&&(T==null||T(),D(q))},{flush:y,deep:C,immediate:!0})})];return b!=null&&I.push(Ce(b,z).then(()=>p(n)).finally(()=>T==null?void 0:T())),Promise.race(I)}function r(u,y){if(!c.isRef(u))return t(q=>q===u,y);const{flush:C="sync",deep:b=!1,timeout:z,throwOnTimeout:T}=y!=null?y:{};let H=null;const D=[new Promise(q=>{H=c.watch([n,u],([L,j])=>{e!==(L===j)&&(H==null||H(),q(L))},{flush:C,deep:b,immediate:!0})})];return z!=null&&D.push(Ce(z,T).then(()=>p(n)).finally(()=>(H==null||H(),p(n)))),Promise.race(D)}function i(u){return t(y=>Boolean(y),u)}function a(u){return r(null,u)}function o(u){return r(void 0,u)}function d(u){return t(Number.isNaN,u)}function s(u,y){return t(C=>{const b=Array.from(C);return b.includes(u)||b.includes(p(u))},y)}function f(u){return h(1,u)}function h(u=1,y){let C=-1;return t(()=>(C+=1,C>=u),y)}return Array.isArray(p(n))?{toMatch:t,toContains:s,changed:f,changedTimes:h,get not(){return ce(n,!e)}}:{toMatch:t,toBe:r,toBeTruthy:i,toBeNull:a,toBeNaN:d,toBeUndefined:o,changed:f,changedTimes:h,get not(){return ce(n,!e)}}}function rt(n){return ce(n)}function it(n,e,t={}){const{immediate:r=!0}=t,i=c.ref(!1);let a=null;function o(){a&&(clearTimeout(a),a=null)}function d(){i.value=!1,o()}function s(...f){o(),i.value=!0,a=setTimeout(()=>{i.value=!1,a=null,n(...f)},p(e))}return r&&(i.value=!0,ie&&s()),oe(d),{isPending:i,start:s,stop:d}}function at(n){var e;const t=p(n);return(e=t==null?void 0:t.$el)!=null?e:t}const se=ie?window:void 0;function V(...n){let e,t,r,i;if(Ze(n[0])||Array.isArray(n[0])?([t,r,i]=n,e=se):[e,t,r,i]=n,!e)return et;Array.isArray(t)||(t=[t]),Array.isArray(r)||(r=[r]);const a=[],o=()=>{a.forEach(h=>h()),a.length=0},d=(h,u,y)=>(h.addEventListener(u,y,i),()=>h.removeEventListener(u,y,i)),s=c.watch(()=>at(e),h=>{o(),h&&a.push(...t.flatMap(u=>r.map(y=>d(h,u,y))))},{immediate:!0,flush:"post"}),f=()=>{s(),o()};return oe(f),f}const ue=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},fe="__vueuse_ssr_handlers__";ue[fe]=ue[fe]||{},ue[fe];function de(n,e={}){const{immediate:t=!0,window:r=se}=e,i=c.ref(!1);let a=null;function o(){!i.value||!r||(n(),a=r.requestAnimationFrame(o))}function d(){!i.value&&r&&(i.value=!0,o())}function s(){i.value=!1,a!=null&&r&&(r.cancelAnimationFrame(a),a=null)}return t&&d(),oe(s),{isActive:i,pause:s,resume:d}}var ot=Object.defineProperty,lt=Object.defineProperties,ct=Object.getOwnPropertyDescriptors,Se=Object.getOwnPropertySymbols,st=Object.prototype.hasOwnProperty,ut=Object.prototype.propertyIsEnumerable,We=(n,e,t)=>e in n?ot(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,v=(n,e)=>{for(var t in e||(e={}))st.call(e,t)&&We(n,t,e[t]);if(Se)for(var t of Se(e))ut.call(e,t)&&We(n,t,e[t]);return n},M=(n,e)=>lt(n,ct(e));const ft={json:"application/json",text:"text/plain",formData:"multipart/form-data"};function J(n){return nt(n,"immediate","refetch","initialData","timeout","beforeFetch","afterFetch","onFetchError","fetch")}function dt(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function U(n){return typeof Headers<"u"&&n instanceof Headers?Object.fromEntries([...n.entries()]):n}function R(n,...e){return n==="overwrite"?async t=>{const r=e[e.length-1];return r!==void 0&&await r(t),t}:async t=>(await e.reduce((r,i)=>r.then(async()=>{i&&(t=v(v({},t),await i(t)))}),Promise.resolve()),t)}function ht(n={}){const e=n.combination||"chain",t=n.options||{},r=n.fetchOptions||{};function i(a,...o){const d=c.computed(()=>{const h=p(n.baseUrl),u=p(a);return h&&!dt(u)?yt(h,u):u});let s=t,f=r;return o.length>0&&(J(o[0])?s=M(v(v({},s),o[0]),{beforeFetch:R(e,t.beforeFetch,o[0].beforeFetch),afterFetch:R(e,t.afterFetch,o[0].afterFetch),onFetchError:R(e,t.onFetchError,o[0].onFetchError)}):f=M(v(v({},f),o[0]),{headers:v(v({},U(f.headers)||{}),U(o[0].headers)||{})})),o.length>1&&J(o[1])&&(s=M(v(v({},s),o[1]),{beforeFetch:R(e,t.beforeFetch,o[1].beforeFetch),afterFetch:R(e,t.afterFetch,o[1].afterFetch),onFetchError:R(e,t.onFetchError,o[1].onFetchError)})),mt(d,f,s)}return i}function mt(n,...e){var t;const r=typeof AbortController=="function";let i={},a={immediate:!0,refetch:!1,timeout:0};const o={method:"GET",type:"text",payload:void 0};e.length>0&&(J(e[0])?a=v(v({},a),e[0]):i=e[0]),e.length>1&&J(e[1])&&(a=v(v({},a),e[1]));const{fetch:d=(t=se)==null?void 0:t.fetch,initialData:s,timeout:f}=a,h=ae(),u=ae(),y=ae(),C=c.ref(!1),b=c.ref(!1),z=c.ref(!1),T=c.ref(null),H=c.shallowRef(null),I=c.shallowRef(null),D=c.shallowRef(s),q=c.computed(()=>r&&b.value);let L,j;const Xe=()=>{r&&L&&L.abort()},ge=_=>{b.value=_,C.value=!_};f&&(j=it(Xe,f,{immediate:!1}));const ee=async(_=!1)=>{var B;ge(!0),I.value=null,T.value=null,z.value=!1,L=void 0,r&&(L=new AbortController,L.signal.onabort=()=>z.value=!0,i=M(v({},i),{signal:L.signal}));const k={method:o.method,headers:{}};if(o.payload){const ne=U(k.headers);o.payloadType&&(ne["Content-Type"]=(B=ft[o.payloadType])!=null?B:o.payloadType);const re=p(o.payload);k.body=o.payloadType==="json"?JSON.stringify(re):re}let Y=!1;const N={url:p(n),options:v(v({},k),i),cancel:()=>{Y=!0}};if(a.beforeFetch&&Object.assign(N,await a.beforeFetch(N)),Y||!d)return ge(!1),Promise.resolve(null);let O=null;return j&&j.start(),new Promise((ne,re)=>{var Je;d(N.url,M(v(v({},k),N.options),{headers:v(v({},U(k.headers)),U((Je=N.options)==null?void 0:Je.headers))})).then(async P=>{if(H.value=P,T.value=P.status,O=await P[o.type](),a.afterFetch&&T.value>=200&&T.value<300&&({data:O}=await a.afterFetch({data:O,response:P})),D.value=O,!P.ok)throw new Error(P.statusText);return h.trigger(P),ne(P)}).catch(async P=>{let Ke=P.message||P.name;return a.onFetchError&&({data:O,error:Ke}=await a.onFetchError({data:O,error:P,response:H.value})),D.value=O,I.value=Ke,u.trigger(P),_?re(P):ne(null)}).finally(()=>{ge(!1),j&&j.stop(),y.trigger(null)})})},Ye=le(a.refetch);c.watch([Ye,le(n)],([_])=>_&&ee(),{deep:!0});const te={isFinished:C,statusCode:T,response:H,error:I,data:D,isFetching:b,canAbort:q,aborted:z,abort:Xe,execute:ee,onFetchResponse:h.on,onFetchError:u.on,onFetchFinally:y.on,get:G("GET"),put:G("PUT"),post:G("POST"),delete:G("DELETE"),patch:G("PATCH"),head:G("HEAD"),options:G("OPTIONS"),json:X("json"),text:X("text"),blob:X("blob"),arrayBuffer:X("arrayBuffer"),formData:X("formData")};function G(_){return(B,k)=>{if(!b.value){o.method=_,o.payload=B,o.payloadType=k,c.isRef(o.payload)&&c.watch([Ye,le(o.payload)],([N])=>N&&ee(),{deep:!0});const Y=p(o.payload);return!k&&Y&&Object.getPrototypeOf(Y)===Object.prototype&&(o.payloadType="json"),M(v({},te),{then(N,O){return be().then(N,O)}})}}}function be(){return new Promise((_,B)=>{rt(C).toBe(!0).then(()=>_(te)).catch(k=>B(k))})}function X(_){return()=>{if(!b.value)return o.type=_,M(v({},te),{then(B,k){return be().then(B,k)}})}}return a.immediate&&setTimeout(ee,0),M(v({},te),{then(_,B){return be().then(_,B)}})}function yt(n,e){return!n.endsWith("/")&&!e.startsWith("/")?`${n}/${e}`:`${n}${e}`}var Fe;(function(n){n.UP="UP",n.RIGHT="RIGHT",n.DOWN="DOWN",n.LEFT="LEFT",n.NONE="NONE"})(Fe||(Fe={}));var pt=Object.defineProperty,we=Object.getOwnPropertySymbols,vt=Object.prototype.hasOwnProperty,gt=Object.prototype.propertyIsEnumerable,_e=(n,e,t)=>e in n?pt(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,bt=(n,e)=>{for(var t in e||(e={}))vt.call(e,t)&&_e(n,t,e[t]);if(we)for(var t of we(e))gt.call(e,t)&&_e(n,t,e[t]);return n};bt({linear:tt},{easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]});const A=n=>n===void 0;function m(n,e){const t=p(n);return A(t)?e:Number(t)}function $(n,e){const t=p(n);return Array.isArray(t)?t:t?String(t):e}function S(n,e){const t=p(n);return A(t)?e:String(t)}function W(n,e){const t=p(n);return A(t)?e:Boolean(t)}const K={src:{type:String,default:null},audioControls:{type:Boolean,default:!0},corsAnonym:{type:Boolean,default:!1},canvWidth:{type:Number,default:300},canvHeight:{type:Number,default:80},canvFillColor:{type:[String,Array],default:""},placeholder:{type:Boolean,default:!0}},w={...K,...{barWidth:{type:Number,default:5},barSpace:{type:Number,default:1},barColor:{type:[String,Array],default:"#0A0AFF"},capsHeight:{type:Number,default:0},capsDropSpeed:{type:Number,default:.9},capsColor:{type:String,default:"#A0A0FF"},brickHeight:{type:Number,default:0},brickSpace:{type:Number,default:1},symmetric:{type:Boolean,default:!1},fftSize:{type:Number,default:1024}}};function Ct(){return w}class Pe{constructor(e){l(this,"barColor");l(this,"barSpace");l(this,"barWidth");l(this,"brickHeight");l(this,"brickSpace");l(this,"canvFillColor");l(this,"canvHeight");l(this,"canvWidth");l(this,"capsColor");l(this,"capsDropSpeed");l(this,"capsHeight");l(this,"fftSize");l(this,"frqBits");l(this,"placeholder");l(this,"symmetric");this.barColor=$(e.barColor,w.barColor.default),this.barSpace=m(e.barSpace,w.barSpace.default),this.brickHeight=m(e.brickHeight,w.brickHeight.default),this.brickSpace=m(e.brickSpace,w.brickSpace.default),this.canvFillColor=$(e.canvFillColor,w.canvFillColor.default),this.canvHeight=m(e.canvHeight,w.canvHeight.default),this.canvWidth=m(e.canvWidth,w.canvWidth.default),this.capsColor=S(e.capsColor,w.capsColor.default),this.capsDropSpeed=m(e.capsDropSpeed,w.capsDropSpeed.default),this.capsHeight=m(e.capsHeight,w.capsHeight.default),this.fftSize=m(e.fftSize,w.fftSize.default),this.frqBits=this.fftSize>>1,this.placeholder=W(e.placeholder,w.placeholder.default),this.symmetric=W(e.symmetric,w.symmetric.default);const t=m(e.barWidth,w.barWidth.default);this.barWidth=t>this.canvWidth?this.canvWidth:t}alignSym(e){return this.symmetric?(this.canvHeight-e)/2:0}}const Te={...K,...{lineWidth:{type:Number,default:2},lineColor:{type:[String,Array],default:"#9F9"},fftSize:{type:Number,default:128}}};function St(){return Te}class ke{constructor(e){l(this,"canvWidth");l(this,"canvHeight");l(this,"canvFillColor");l(this,"lineWidth");l(this,"lineColor");l(this,"fftSize");l(this,"placeholder");const t=Te;this.canvWidth=m(e.canvWidth,t.canvWidth.default),this.canvHeight=m(e.canvHeight,t.canvHeight.default),this.canvFillColor=$(e.canvFillColor,t.canvFillColor.default),this.lineWidth=m(e.lineWidth,t.lineWidth.default),this.lineColor=$(e.lineColor,t.lineColor.default),this.fftSize=m(e.fftSize,t.fftSize.default),this.placeholder=W(e.placeholder,t.placeholder.default)}}const He={...K,...{fftSize:{type:Number,default:1024},canvWidth:{type:Number,default:100},canvHeight:{type:Number,default:100},radius:{type:Number,default:0},lineWidth:{type:Number,default:1},lineSpace:{type:Number,default:1},outlineColor:{type:String,default:"#0000FF"},outlineWidth:{type:Number,default:.3},barWidth:{type:Number,default:1},barLength:{type:Number,default:0},barColor:{type:[String,Array],default:["#FFFFFF","#0000FF"]},progress:{type:Boolean,default:!0},progressWidth:{type:Number,default:1},progressColor:{type:String,default:"#0000FF"},progressClockwise:{type:Boolean,default:!0},outlineMeterSpace:{type:Number,default:3},playtime:{type:Boolean,default:!1},playtimeFont:{type:String,default:"14px Monaco"},playtimeColor:{type:String,default:"#00f"},rotateGraph:{type:Boolean,default:!1},rotateSpeed:{type:Number,default:.001}}};function Wt(){return He}let Z=1.5;class Be{constructor(e){l(this,"barColor");l(this,"barLength");l(this,"barWidth");l(this,"canvFillColor");l(this,"canvHeight");l(this,"canvWidth");l(this,"fftSize");l(this,"lineSpace");l(this,"lineWidth");l(this,"outlineColor");l(this,"outlineMeterSpace");l(this,"outlineWidth");l(this,"placeholder");l(this,"playtime");l(this,"playtimeColor");l(this,"playtimeFont");l(this,"progress");l(this,"progressClockwise");l(this,"progressColor");l(this,"progressWidth");l(this,"radius");l(this,"rotateGraph");l(this,"rotateSpeed");const t=He;this.barColor=$(e.barColor,t.barColor.default),this.barLength=m(e.barLength,t.barLength.default),this.barWidth=m(e.barWidth,t.barWidth.default),this.canvFillColor=$(e.canvFillColor,t.canvFillColor.default),this.canvHeight=m(e.canvHeight,t.canvHeight.default),this.canvWidth=m(e.canvWidth,t.canvWidth.default),this.fftSize=m(e.fftSize,t.fftSize.default),this.lineSpace=m(e.lineSpace,t.lineSpace.default),this.lineWidth=m(e.lineWidth,t.lineWidth.default),this.outlineColor=S(e.outlineColor,t.outlineColor.default),this.outlineMeterSpace=m(e.outlineMeterSpace,t.outlineMeterSpace.default),this.outlineWidth=m(e.outlineWidth,t.outlineWidth.default),this.lineWidth=m(e.lineWidth,t.lineWidth.default),this.placeholder=W(e.placeholder,t.placeholder.default),this.playtime=W(e.playtime,t.playtime.default),this.playtimeColor=S(e.playtimeColor,t.playtimeColor.default),this.playtimeFont=S(e.playtimeFont,t.playtimeFont.default),this.progress=W(e.progress,t.progress.default),this.progressClockwise=W(e.progressClockwise,t.progressClockwise.default),this.progressColor=S(e.progressColor,t.progressColor.default),this.progressWidth=m(e.progressWidth,t.progressWidth.default),this.radius=m(e.radius,t.radius.default),this.rotateGraph=W(e.rotateGraph,t.rotateGraph.default),this.rotateSpeed=m(e.rotateSpeed,t.rotateSpeed.default)}get cx(){return this.canvWidth/2}get cy(){return this.canvHeight/2}get r(){return this.radius>0?this.radius:Math.round(this.canvWidth/2*.7)}get arcStep(){return Math.ceil(this.lineWidth+this.lineSpace)}get barLen(){return this.barLength>0?this.barLength:this.canvWidth/2-this.r}get angle(){const e=()=>Z===3.5?1.5:Z+this.rotateSpeed;return Z=this.rotateGraph?e():1.5,Math.PI*Z}}const Ae={...K,...{canvWidth:{type:Number,default:500},canvHeight:{type:Number,default:80},playedLineWidth:{type:Number,default:.5},playedLineColor:{type:String,default:"navy"},noplayedLineWidth:{type:Number,default:.5},noplayedLineColor:{type:String,default:"lime"},playtime:{type:Boolean,default:!0},playtimeWithMs:{type:Boolean,default:!0},playtimeFontSize:{type:Number,default:12},playtimeFontFamily:{type:String,default:"monospace"},playtimeFontColor:{type:String,default:"grey"},playtimeTextBottom:{type:Boolean,default:!1},playtimeSlider:{type:Boolean,default:!0},playtimeSliderColor:{type:String,default:"red"},playtimeSliderWidth:{type:Number,default:1},playtimeClickable:{type:Boolean,default:!0},requester:{type:Function,default:fetch}}};function Ft(){return Ae}class wt{constructor(e){l(this,"src");l(this,"canvWidth");l(this,"canvHeight");l(this,"canvFillColor");l(this,"currentTime");l(this,"duration");l(this,"playedLineWidth");l(this,"playedLineColor");l(this,"noplayedLineWidth");l(this,"noplayedLineColor");l(this,"playtime");l(this,"playtimeWithMs");l(this,"playtimeFontSize");l(this,"playtimeFontFamily");l(this,"playtimeFontColor");l(this,"playtimeTextBottom");l(this,"playtimeSlider");l(this,"playtimeSliderColor");l(this,"playtimeSliderWidth");l(this,"playtimeClickable");const t=Ae;this.canvWidth=m(e.canvWidth,t.canvWidth.default),this.canvHeight=m(e.canvHeight,t.canvHeight.default),this.canvFillColor=$(e.canvFillColor,t.canvFillColor.default),this.playedLineWidth=m(e.playedLineWidth,t.playedLineWidth.default),this.playedLineColor=S(e.playedLineColor,t.playedLineColor.default),this.noplayedLineWidth=m(e.noplayedLineWidth,t.noplayedLineWidth.default),this.noplayedLineColor=S(e.noplayedLineColor,t.noplayedLineColor.default),this.playtime=W(e.playtime,t.playtime.default),this.playtimeWithMs=W(e.playtimeWithMs,t.playtimeWithMs.default),this.playtimeFontSize=m(e.playtimeFontSize,t.playtimeFontSize.default),this.playtimeFontFamily=S(e.playtimeFontFamily,t.playtimeFontFamily.default),this.playtimeFontColor=S(e.playtimeFontColor,t.playtimeFontColor.default),this.playtimeTextBottom=W(e.playtimeTextBottom,t.playtimeTextBottom.default),this.playtimeSlider=W(e.playtimeSlider,t.playtimeSlider.default),this.playtimeSliderColor=S(e.playtimeSliderColor,t.playtimeSliderColor.default),this.playtimeSliderWidth=m(e.playtimeSliderWidth,t.playtimeSliderWidth.default),this.playtimeClickable=W(e.playtimeClickable,t.playtimeClickable.default),this.src=A(e.src)?null:String(e.src),this.currentTime=0,this.duration=0}get playX(){return this.duration?~~(this.currentTime/this.duration*this.canvWidth):0}get timePlayed(){const e=[this.currentTime/3600,this.currentTime/60%60,this.currentTime%60].map(r=>String(~~r).padStart(2,"0")).join(":");if(!this.playtimeWithMs)return e;const t=~~(this.currentTime%1*1e3);return[e,String(t).padStart(3,"0")].join(".")}}const Le={...{media:{type:Object,required:!1,default:null},canvWidth:{type:Number,default:0},canvClass:{type:String,default:""},canvHeight:{type:Number,default:0},canvFillColor:{type:String,default:""},circleGradient:{type:Array,default:[[0,"palegreen"],[.3,"lime"],[.7,"limegreen"],[1,"green"]]},fftSize:{type:Number},type:{type:String,default:"wform"},frequLnum:{type:Number,default:60},frequLineCap:{type:Boolean,default:!1},frequDirection:{type:String,default:"lr"},lineColor:{type:String,default:"lime"},lineWidth:{type:Number},radius:{type:Number,default:4},connectDestination:{type:Boolean,default:!1},vbarBgColor:{type:String,default:"#e1e1e1"},vbarCaps:{type:Boolean,default:!0},vbarSpace:{type:Number,default:1},vbarWidth:{type:Number,default:4},vbarFillColor:{type:String,default:"lime"},vbarRightColor:{type:String,default:"#c0c0c0"}}};function _t(){return Le}class he{constructor(e){l(this,"canvWidth");l(this,"canvHeight");l(this,"canvFillColor");l(this,"canvClass");l(this,"circleGradient");l(this,"fftSize");l(this,"type");l(this,"frequLnum");l(this,"frequLineCap");l(this,"frequDirection");l(this,"lineColor");l(this,"lineWidth");l(this,"radius");l(this,"connectDestination");l(this,"vbarBgColor");l(this,"vbarCaps");l(this,"vbarFillColor");l(this,"vbarRightColor");l(this,"vbarSpace");l(this,"vbarWidth");const t=Le;this.canvFillColor=S(e.canvFillColor,t.canvFillColor.default),this.canvClass=S(e.canvClass,t.canvClass.default),this.circleGradient=A(e.circleGradient)?t.circleGradient.default:e.circleGradient,this.type=S(e.type,t.type.default),this.fftSize=A(e.fftSize)?this.type==="frequ"?1024:8192:Number(e.fftSize),this.frequLnum=m(e.frequLnum,t.frequLnum.default),this.frequLineCap=W(e.frequLineCap,t.frequLineCap.default),this.frequDirection=S(e.frequDirection,t.frequDirection.default),this.lineColor=S(e.lineColor,t.lineColor.default),this.lineWidth=A(e.lineWidth)?this.type==="frequ"?3:.5:Number(e.lineWidth),this.radius=m(e.radius,t.radius.default),this.connectDestination=W(e.connectDestination,t.connectDestination.default),this.vbarBgColor=S(e.vbarBgColor,t.vbarBgColor.default),this.vbarCaps=W(e.vbarCaps,t.vbarCaps.default),this.vbarFillColor=S(e.vbarFillColor,t.vbarFillColor.default),this.vbarRightColor=S(e.vbarRightColor,t.vbarRightColor.default),this.vbarSpace=m(e.vbarSpace,t.vbarSpace.default),this.vbarWidth=m(e.vbarWidth,t.vbarWidth.default),this.canvWidth=A(e.canvWidth)||Number(e.canvWidth)===0?this.defaultWidth:Number(e.canvWidth),this.canvHeight=A(e.canvHeight)||Number(e.canvHeight)===0?this.defaultHeight:Number(e.canvHeight)}get defaultWidth(){switch(this.type){case"vbar":return 50;case"frequ":return 300;case"circle":return 80;default:return 200}}get defaultHeight(){switch(this.type){case"vbar":return 20;case"frequ":return 80;case"circle":return 80;default:return 40}}}function me(n,e,t){let r=null,i=null,a=null;const o=e||1024,d=new Uint8Array(o/2),{pause:s,resume:f}=de(()=>{!i||(i.getByteFrequencyData(d),t(d))},{immediate:!1});V(n,"play",()=>{const h=p(n);!h||(r||(r=new AudioContext,a=r.createMediaElementSource(h)),i=r.createAnalyser(),i.fftSize=o,a==null||a.connect(i),i.connect(r.destination),r.resume(),f())}),V(n,"pause",()=>{r==null||r.suspend(),a==null||a.disconnect(),i==null||i.disconnect(),s()})}function x(n,e){const t=c.ref(null);return c.watchEffect(()=>{const r=p(n);!r||(t.value=r.getContext("2d"),r.width=e.canvWidth,r.height=e.canvHeight)}),t}function ye(n,e,t,r){n.clearRect(0,0,e,t),r&&(n.fillStyle=pe(n,e,t,r),n.fillRect(0,0,e,t))}function pe(n,e,t,r){if(!Array.isArray(r))return r||"";const i=n.createLinearGradient(e/2,0,e/2,t);let a=0;return r.forEach(o=>{i.addColorStop(a,o),a+=1/r.length}),i}const Q=Array(16).fill(0);function Ne(n,e,t){const r=new Pe(t);Q.length=r.fftSize/2,Q.fill(0);const i=x(e,r);V(n,"loadedmetadata",()=>{!r.placeholder||!i||Oe(new Uint8Array(r.fftSize/2),i,t)}),me(n,r.fftSize,a=>{Oe(a,i,t)})}function Oe(n,e,t){const r=p(e);if(!r)return;const i=new Pe(t),a=Math.round((i.barWidth+i.barSpace)/i.frqBits*i.canvWidth),o=n.length;let d=0;ye(r,i.canvWidth,i.canvHeight,i.canvFillColor);for(let s=0;s<o;s++){if(s%a)continue;const f=Math.round(n.slice(s,s+a).reduce((u,y)=>y+u,0)/a),h=f/255*i.canvHeight;Pt(r,i,f,s,d),r.fillStyle=pe(r,i.canvWidth,i.canvHeight,i.barColor),i.brickHeight>0?Tt(r,i,h,d):r.fillRect(d,i.canvHeight-h-i.alignSym(h),i.barWidth,h),d+=i.barWidth+i.barSpace}}function Pt(n,e,t,r,i){if(e.capsHeight===0)return;const a=Q[r]<=t?t:Q[r]-e.capsDropSpeed;Q[r]=a;const o=a/255*e.canvHeight,d=e.canvHeight-o-e.capsHeight-e.alignSym(o);n.fillStyle=e.capsColor,n.fillRect(i,d,e.barWidth,e.capsHeight),e.symmetric&&n.fillRect(i,e.canvHeight-d-e.capsHeight,e.barWidth,e.capsHeight)}function Tt(n,e,t,r){for(let i=0;i<t;i+=e.brickHeight+e.brickSpace)n.fillRect(r,e.canvHeight-t+i-e.alignSym(t),e.barWidth,e.brickHeight)}const kt=["controls","src"],Ee=c.defineComponent({__name:"AVBars",props:Ct(),setup(n){const e=n,t=c.ref(null),r=c.ref(null);return Ne(t,r,e),(i,a)=>(c.openBlock(),c.createElementBlock(c.Fragment,null,[c.createElementVNode("audio",{ref_key:"player",ref:t,controls:e.audioControls,src:e.src},null,8,kt),c.createElementVNode("canvas",{ref_key:"canvas",ref:r},null,512)],64))}});function Me(n,e,t){const r=new Be(t),i=x(e,r);V(n,"loadedmetadata",()=>{Bt(i,r)}),me(n,r.fftSize,a=>{Ht(a,i,n,new Be(t))})}function Ht(n,e,t,r){const i=p(e);if(!i)return;const a=p(t);if(!a)return;const o=n.length,d=(r.lineWidth+r.lineSpace)/o*(2*Math.PI);ye(i,r.canvWidth,r.canvHeight,r.canvFillColor),ze(i,r),At(i,a,r),Lt(i,a,r),i.lineWidth=r.barWidth,i.strokeStyle=Nt(i,r);let s=r.angle;for(let f=0;f<o;f++){if(s+=d,f%r.arcStep)continue;const h=Math.round(n.slice(f,f+r.arcStep).reduce((y,C)=>C+y,0)/r.arcStep),u=r.r+h/255*r.barLen;i.beginPath(),i.moveTo(r.r*Math.cos(s)+r.cx,r.r*Math.sin(s)+r.cy),i.lineTo(u*Math.cos(s)+r.cx,u*Math.sin(s)+r.cy),i.stroke()}}function Bt(n,e){const t=p(n);!t||(ze(t,e),De(t,"0:00",e))}function ze(n,e){e.outlineWidth!==0&&(n.beginPath(),n.strokeStyle=e.outlineColor,n.lineWidth=e.outlineWidth,n.arc(e.cx,e.cy,e.r,0,2*Math.PI),n.stroke())}function At(n,e,t){if(!t.progress)return;const{currentTime:r,duration:i}=e,a=r/i*2*Math.PI,o=Math.PI*1.5+a;!a||(n.lineWidth=t.progressWidth,n.strokeStyle=t.progressColor,n.beginPath(),n.arc(t.cx,t.cy,t.r-t.outlineWidth-t.outlineMeterSpace,1.5*Math.PI,o,t.progressClockwise),n.stroke())}function Lt(n,e,t){const{currentTime:r}=e,i=Math.floor(r/60),a=Math.floor(r)%60,o=a<10?`0${a}`:`${a}`,d=`${i}:${o}`;De(n,d,t)}function De(n,e,t){n.font=t.playtimeFont,n.fillStyle=t.playtimeColor,n.textAlign="center",n.fillText(e,t.cx,t.cy+parseInt(t.playtimeFont)*.25)}function Nt(n,e){if(!Array.isArray(e.barColor))return e.barColor;const t=n.createRadialGradient(e.cx,e.cy,e.canvWidth/2,e.cx,e.cy,0);let r=0;return e.barColor.forEach(i=>{t.addColorStop(r,i),r+=1/e.barColor.length}),t}const Ot=["controls","src"],qe=c.defineComponent({__name:"AVCircle",props:Wt(),setup(n){const e=n,t=c.ref(null),r=c.ref(null);return Me(t,r,e),(i,a)=>(c.openBlock(),c.createElementBlock(c.Fragment,null,[c.createElementVNode("audio",{ref_key:"player",ref:t,controls:e.audioControls,src:e.src},null,8,Ot),c.createElementVNode("canvas",{ref_key:"canvas",ref:r},null,512)],64))}});function Ve(n,e,t){const r=new ke(t),i=x(e,r);c.watch(i,()=>{!r.placeholder||!p(i)||$e(new Uint8Array(r.fftSize),i,r)}),me(n,r.fftSize,a=>{$e(a,i,new ke(t))})}function $e(n,e,t){const r=p(e);if(!r)return;const i=t.canvWidth,a=t.canvHeight,o=t.lineWidth,d=n.length,s=~~i/2/d;let f=0;const h=()=>{let u=0;for(let y=0;y<d;y++){const C=n[y];u=a*(255-C)/510,y%2&&(u=a-u),r.lineTo(f,u),f+=s}return f};ye(r,i,a,t.canvFillColor),r.lineWidth=o,r.strokeStyle=pe(r,i,a,t.lineColor),r.beginPath(),n.reverse(),r.moveTo(f,a/2),f=h(),n.reverse(),h(),r.lineTo(i,a/2),r.stroke()}const Et=["controls","src"],Ie=c.defineComponent({__name:"AVLine",props:St(),setup(n){const e=n,t=c.ref(null),r=c.ref(null);return Ve(t,r,e),(i,a)=>(c.openBlock(),c.createElementBlock(c.Fragment,null,[c.createElementVNode("audio",{ref_key:"player",ref:t,controls:e.audioControls,src:e.src},null,8,Et),c.createElementVNode("canvas",{ref_key:"canvas",ref:r},null,512)],64))}}),F=[];function je(n,e,t,r={}){const i=new wt(t),a=x(e,i);Mt(a,i,r);const{pause:o,resume:d}=de(()=>{var s,f;i.currentTime=(f=(s=n==null?void 0:n.value)==null?void 0:s.currentTime)!=null?f:0,ve(a,i)},{immediate:!1});V(n,"play",()=>d()),V(n,"pause",()=>o()),V(e,"click",s=>{if(!i.playtimeClickable)return;const f=p(n);!f||(f.currentTime=s.offsetX/i.canvWidth*i.duration,i.currentTime=f.currentTime,ve(a,i))})}function ve(n,e){const t=p(n);if(!t)return;let r=0;t.clearRect(0,0,e.canvWidth,e.canvHeight);const i=(a,o,d,s)=>{for(t.lineWidth=d,t.strokeStyle=s,t.beginPath();a<o;a++)t.moveTo(a,F[a][0]),t.lineTo(a,F[a][1]);return t.stroke(),a};r=i(r,e.playX,e.playedLineWidth,e.playedLineColor),i(r,F.length,e.noplayedLineWidth,e.noplayedLineColor),Ge(t,e),e.playtime&&Re(t,e)}function Ge(n,e){n.lineWidth=e.playtimeSliderWidth,n.strokeStyle=e.playtimeSliderColor,n.beginPath(),n.moveTo(e.playX,0),n.lineTo(e.playX,e.canvHeight),n.stroke()}function Re(n,e){const t=e.timePlayed,r=3,i=~~n.measureText(t).width,a=e.playX>e.canvWidth-i-r?e.playX-i-r:e.playX+r,o=e.playtimeTextBottom?e.canvHeight-e.playtimeFontSize+r:e.playtimeFontSize+r;n.fillStyle=e.playtimeFontColor,n.font=`${e.playtimeFontSize}px ${e.playtimeFontFamily}`,n.fillText(t,a,o)}function Mt(n,e,t){if(!e.src)return;ht(t)(e.src).arrayBuffer().then(({error:i,data:a})=>{const o=p(i);if(o!==null){console.error(`Failed get url '${e.src}': ${o}`);return}if(a.value===null){console.error("invalid arrayBuffer data received");return}new AudioContext().decodeAudioData(a.value).then(s=>{e.duration=s.duration,zt(s,e),ve(n,e)}).catch(s=>{console.error("Failed to decode audio array buffer:",s)})}),c.watchEffect(()=>{const i=p(n);!i||(i.lineWidth=e.noplayedLineWidth,i.strokeStyle=e.noplayedLineColor,i.beginPath(),i.moveTo(0,e.canvHeight/2),i.lineTo(e.canvWidth,e.canvHeight/2),i.stroke(),Ge(i,e),e.playtime&&Re(i,e))})}function zt(n,e){F.slice(0);let t=0,r=0,i=0,a=0;const o=Math.ceil(n.length/e.canvWidth),d=e.canvWidth,s=e.canvHeight;for(let f=0;f<n.numberOfChannels;f++){const h=n.getChannelData(f);for(let u=0;u<d;u++){const y=~~(u*o),C=~~(y+o);t=0,r=0;for(let b=y;b<C;b++)t=h[b]<t?h[b]:t,r=h[b]>r?h[b]:r;F[u]&&(F[u][0]=F[u][0]<r?r:F[u][0],F[u][1]=F[u][1]>t?t:F[u][1]),F[u]=[r,t]}}for(let f=0;f<F.length;f++)r=F[f][0],t=F[f][1],i=s/2-r*s/2,a=s/2-t*s/2,F[f]=[i,a===i?i+1:a]}const Dt=["controls","src"],Ue=c.defineComponent({__name:"AVWaveform",props:Ft(),setup(n){const e=n,t=c.ref(null),r=c.ref(null);return je(t,r,e,{options:{refetch:!0},fetchOptions:{mode:"cors"}}),(i,a)=>(c.openBlock(),c.createElementBlock(c.Fragment,null,[c.createElementVNode("audio",{ref_key:"player",ref:t,controls:e.audioControls,src:e.src},null,8,Dt),c.createElementVNode("canvas",{ref_key:"canvas",ref:r},null,512)],64))}});function xe(n,e){const t=e;let r;const i=x(n,new he(t)),{pause:a,resume:o}=de(()=>{!r||Vt(r,i,new he(t))},{immediate:!1});c.watchEffect(()=>{const d=p(t.media);d?(r=qt(d,new he(t)),o()):a()})}function qt(n,e){const t=new AudioContext,r=t.createAnalyser();return t.createMediaStreamSource(n).connect(r),r.fftSize=e.fftSize,e.connectDestination&&r.connect(t.destination),r}function Vt(n,e,t){const r=p(e);if(!r)return;const i=new Uint8Array(n.fftSize);switch(t.canvFillColor&&(r.fillStyle=t.canvFillColor),r.clearRect(0,0,t.canvWidth,t.canvHeight),r.beginPath(),r.strokeStyle=t.lineColor,t.type){case"frequ":n.getByteFrequencyData(i),$t(i,r,t);break;case"circle":n.getByteFrequencyData(i),jt(i,r,t);break;case"vbar":n.getByteFrequencyData(i),It(i,r,t);break;default:n.getByteTimeDomainData(i),Gt(i,r,t);break}}function $t(n,e,t){const r=t.frequDirection==="mo",i=r?t.canvWidth/2:0,a=r?t.frequLnum/2:t.frequLnum,o=r?t.canvWidth/a/2:t.canvWidth/a,d=t.canvHeight,s=t.lineWidth||2;for(let f=0;f<a;f++){const h=r?f*o:f*o+s,u=n.slice(h,h+o).reduce((C,b)=>C+b/255*d,0)/o,y=(d-u)/2+2;e.lineWidth=s,e.lineCap=t.frequLineCap?"round":"butt",e.moveTo(i+h,y),e.lineTo(i+h,d-y),e.stroke(),r&&f>0&&(e.moveTo(i-h,y),e.lineTo(i-h,d-y),e.stroke())}}function It(n,e,t){const r=t.vbarWidth,i=t.vbarSpace,a=r<5?5:r/2;let o=0;for(let s=0;s<n.length;s++)o=o<n[s]?n[s]:o;const d=o/255*t.canvWidth;e.lineWidth=t.vbarWidth,e.lineCap=t.vbarCaps?"round":"butt",e.fillStyle=t.vbarBgColor,e.fillRect(0,0,t.canvWidth,t.canvHeight);for(let s=r/2;s+r+i<=t.canvWidth;s=s+r+i)e.strokeStyle=s>d?t.vbarRightColor:t.vbarFillColor,e.beginPath(),e.moveTo(s,a),e.lineTo(s,t.canvHeight-a),e.stroke()}function jt(n,e,t){const r=t.canvWidth/2,i=t.canvHeight/2,a=r<i?r:i,d=Math.max(...n)/255*a,s=e.createRadialGradient(r,i,0,r,i,d);for(const[f,h]of t.circleGradient)s.addColorStop(f,h);e.fillStyle=s,e.arc(r,i,d,0,2*Math.PI),e.fill("evenodd")}function Gt(n,e,t){const r=t.canvHeight,i=t.canvWidth/t.fftSize;let a=0;e.lineWidth=t.lineWidth||.5;for(let o=0;o<n.length;o++){const s=n[o]/255*r;e.lineTo(a,s),a+=i}e.stroke()}const Qe=c.defineComponent({__name:"AVMedia",props:_t(),setup(n){const e=n,t=c.ref(null);return xe(t,e),(r,i)=>(c.openBlock(),c.createElementBlock("canvas",{ref_key:"canvas",ref:t},null,512))}}),Rt={install(n){n.component("av-bars",Ee),n.component("av-circle",qe),n.component("av-line",Ie),n.component("av-waveform",Ue),n.component("av-media",Qe)}};g.AVBars=Ee,g.AVCircle=qe,g.AVLine=Ie,g.AVMedia=Qe,g.AVPlugin=Rt,g.AVWaveform=Ue,g.useAVBars=Ne,g.useAVCircle=Me,g.useAVLine=Ve,g.useAVMedia=xe,g.useAVWaveform=je,Object.defineProperties(g,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
